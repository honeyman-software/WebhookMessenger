<ContentDialog
    x:Class="WebhookMessenger.Views.WebhookManagerDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Manage Webhooks"
    PrimaryButtonText="Close"
    MinHeight="640"
    MaxWidth="1400"
    HorizontalContentAlignment="Stretch">

    <!-- Default layout is NARROW to avoid any overlap before VisualState triggers -->
    <Grid x:Name="LayoutRoot" RowSpacing="12" ColumnSpacing="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid.ColumnDefinitions>
            <!-- Default: single column (Col1 collapsed) -->
            <ColumnDefinition x:Name="Col0" Width="*"/>
            <ColumnDefinition x:Name="Col1" Width="0"/>
        </Grid.ColumnDefinitions>

        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup x:Name="AdaptiveStates">

                <!-- WIDE: two columns side-by-side -->
                <VisualState x:Name="Wide">
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="1000"/>
                    </VisualState.StateTriggers>

                    <VisualState.Setters>
                        <Setter Target="Col0.Width" Value="380"/>
                        <Setter Target="Col1.Width" Value="*"/>

                        <!-- Hook list left, spans both rows -->
                        <Setter Target="HookPanel.(Grid.Row)" Value="0"/>
                        <Setter Target="HookPanel.(Grid.Column)" Value="0"/>
                        <Setter Target="HookPanel.(Grid.RowSpan)" Value="2"/>
                        <Setter Target="HookPanel.(Grid.ColumnSpan)" Value="1"/>

                        <!-- Editor right, spans both rows -->
                        <Setter Target="EditorPanel.(Grid.Row)" Value="0"/>
                        <Setter Target="EditorPanel.(Grid.Column)" Value="1"/>
                        <Setter Target="EditorPanel.(Grid.RowSpan)" Value="2"/>
                        <Setter Target="EditorPanel.(Grid.ColumnSpan)" Value="1"/>
                    </VisualState.Setters>
                </VisualState>

            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>

        <!-- LEFT/TOP: list (DEFAULT NARROW placement) -->
        <StackPanel x:Name="HookPanel"
                    Grid.Row="0"
                    Grid.Column="0"
                    Grid.ColumnSpan="2"
                    Grid.RowSpan="1"
                    Spacing="8">
            <TextBlock Text="Webhooks" FontWeight="SemiBold"/>

            <ListView x:Name="HookList"
                      SelectionMode="Single"
                      Height="320"
                      HorizontalAlignment="Stretch"
                      HorizontalContentAlignment="Stretch"
                      ScrollViewer.HorizontalScrollMode="Disabled"
                      ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                <ListView.ItemContainerStyle>
                    <Style TargetType="ListViewItem">
                        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        <Setter Property="Padding" Value="10,8"/>
                        <Setter Property="MinHeight" Value="40"/>
                    </Style>
                </ListView.ItemContainerStyle>

                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Grid HorizontalAlignment="Stretch">
                            <TextBlock Text="{Binding Name}"
                                       TextWrapping="NoWrap"
                                       TextTrimming="CharacterEllipsis"
                                       VerticalAlignment="Center">
                                <ToolTipService.ToolTip>
                                    <ToolTip Content="{Binding Name}" />
                                </ToolTipService.ToolTip>
                            </TextBlock>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </StackPanel>

        <!-- RIGHT/BOTTOM: editor (DEFAULT NARROW placement) -->
        <ScrollViewer x:Name="EditorPanel"
                      Grid.Row="1"
                      Grid.Column="0"
                      Grid.ColumnSpan="2"
                      Grid.RowSpan="1"
                      HorizontalScrollMode="Disabled"
                      HorizontalScrollBarVisibility="Disabled"
                      VerticalScrollMode="Auto"
                      VerticalScrollBarVisibility="Auto">

            <StackPanel Spacing="10">
                <TextBlock Text="Details" FontWeight="SemiBold"/>

                <TextBox x:Name="NameBox" Header="Name"/>

                <PasswordBox x:Name="UrlBox" Header="Webhook URL (stored encrypted)" />

                <Grid ColumnSpacing="12" RowSpacing="8">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Button Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2"
                            Content="Add New"
                            HorizontalAlignment="Stretch"
                            Click="AddNew_Click"/>

                    <Button Grid.Row="1" Grid.Column="0"
                            Content="Save"
                            HorizontalAlignment="Stretch"
                            Click="Save_Click"/>

                    <Button Grid.Row="1" Grid.Column="1"
                            Content="Delete"
                            HorizontalAlignment="Stretch"
                            Click="Delete_Click"/>
                </Grid>

                <TextBlock x:Name="StatusText" Opacity="0.8" TextWrapping="Wrap"/>
            </StackPanel>
        </ScrollViewer>

    </Grid>
</ContentDialog>
